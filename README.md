## Zimbra:

Zimbra Collaboration Suite (ZCS) is a web-based email and collaboration platform, designed for businesses and organizations. It offers a range of tools, which include email, calendar, contacts, task management, file sharing, cloud storage, search options, and instant messaging.  


The main components of Zimbra Mail and Collaboration Server are:

- **Zimbra Core**: These are basic libraries, utilities, monitoring tools, and basic configuration files.
- **Zimbra LDAP**: This has the OpenLDAP LDAP directory server that provides authentication and configs store for users and other zimbra components.
- **Zimbra MTA** (mail routing server): Has Postfix mail transfer agent (MTA) that receives email via SMTP and routes each message to the appropriate Zimbra mailbox server using Local Mail Transfer Protocol (LMTP). It also includes the anti-virus and anti-spam components.
- **Zimbra Store** (Zimbra server): The mailbox server includes Data store, Message store and Index store for the mailboxes on the server. When a mail arrives, the Zimbra server schedules a thread to have the message indexed in the index store.
- **Zimbra-SNMP**: This is an optional component for for monitoring and it runs on every server (Zimbra server, Zimbra LDAP, Zimbra MTA). Swatch is used to watch the syslog output to generate SNMP traps.
- **Zimbra Logger**: This is an optional component for the mailbox server. It installs tools for syslog aggregation, reporting, and message tracing. This is required for the message trace feature.




### Prerequisites:
- OS: CentOS/Rocky Linux
- SElinux disable 
- RAM: Minimum 8 GB, vcpus: 4 and Disk: At least 20 GB free
- Hostname: FQDN (e.g. mail.example.com)
- Static IP Address
- **A record** and **MX record** must point to your Zimbra server.
- Set timezone and NTP



#### Install Dependencies:

```
dnf install -y wget curl perl tar unzip epel-release bind-utils dnf-utils net-tools telnet screen nc rsync
```




#### Environments:

_Set Hostname:_

```
hostnamectl set-hostname mail.technbd.net
```


```
vim /etc/hosts

192.168.10.191    mail.technbd.net    mail
```



```
hostname --fqdn

or,

hostname -f

mail.technbd.net
```



```
vim /etc/selinux/config

SELINUX=disabled
```



```
timedatectl set-timezone Asia/Dhaka

timedatectl set-time 2025-05-13
timedatectl set-time 15:22:03
```



_Disable `postfix` `dovecot` `httpd` `saslauthd` services:_


```
systemctl stop postfix dovecot httpd saslauthd

systemctl disable postfix dovecot httpd saslauthd
```





#### DNS Verify: 

```
cat /etc/resolv.conf

# Generated by NetworkManager
search technbd.net
nameserver 192.168.10.191
nameserver 8.8.8.8
```



_Test DNS using `host` command:_

```
host -t MX technbd.net

technbd.net mail is handled by 10 mail.technbd.net.
```


```
host -t A mail.technbd.net

mail.technbd.net has address 192.168.10.191
```


```
nslookup mail

Server:         192.168.10.191
Address:        192.168.10.191#53

Name:   mail.technbd.net
Address: 192.168.10.191
```


```
nslookup 192.168.10.191

191.10.168.192.in-addr.arpa     name = technbd.net.
```



```
dig mail.technbd.net
dig -x 192.168.10.191

dig A mail.technbd.net
dig MX technbd.net
```


```
dig technbd.net MX +short
dig mail.technbd.net A +short
```



```
nmap localhost

Starting Nmap 6.40 ( http://nmap.org ) at 2025-05-13 01:11 +06
Nmap scan report for localhost (127.0.0.1)
Host is up (0.000018s latency).
Other addresses for localhost (not scanned): 127.0.0.1
Not shown: 998 closed ports

PORT   STATE SERVICE
22/tcp open  ssh
53/tcp open  domain

```




### Download Zimbra Installer:

```
## For RHEL/CentOS 7:
wget https://files.zimbra.com/downloads/8.8.15_GA/zcs-8.8.15_GA_3869.RHEL7_64.20190918004220.tgz


## For RHEL/CentOS 8:
wget https://files.zimbra.com/downloads/8.8.15_GA/zcs-8.8.15_GA_3953.RHEL8_64.20200629025823.tgz
```


```
tar -xvfzcs-8.8.15_GA_3869.RHEL7_64.20190918004220.tgz

cd zcs-8.8.15_GA_3869.RHEL7_64.20190918004220
```


#### Run the Installer:

```
./install.sh -h

./install.sh [-r <dir> -l <file> -a <file> -u -s -c type -x -h] [defaultsfile]

-h|--help               Usage
-l|--license <file>     License file to install.
-a|--activation <file>  License activation file to install. [Upgrades only]
-r|--restore <dir>      Restore contents of <dir> to localconfig
-s|--softwareonly       Software only installation.
-u|--uninstall          Uninstall ZCS
-x|--skipspacecheck     Skip filesystem capacity checks.
--beta-support          Allows installer to upgrade Network Edition Betas.
--platform-override     Allows installer to continue on an unknown OS.
--skip-activation-check Allows installer to continue if license activation checks fail.
--skip-upgrade-check    Allows installer to skip upgrade validation checks.
--force-upgrade         Force upgrade to be set to YES. Used if there is package installation failure for remote packages.
[defaultsfile]          File containing default install values.

```


```
./install.sh 


or,

./install.sh --platform-override
```


```
### Output:

Operations logged to /tmp/install.log.1aodGR3L
Checking for existing installation...
    zimbra-drive...NOT FOUND
    zimbra-imapd...NOT FOUND
    zimbra-patch...NOT FOUND
    zimbra-mta-patch...NOT FOUND
    zimbra-proxy-patch...NOT FOUND
    zimbra-license-tools...NOT FOUND
    zimbra-license-extension...NOT FOUND
    zimbra-network-store...NOT FOUND
    zimbra-network-modules-ng...NOT FOUND
    zimbra-chat...NOT FOUND
    zimbra-talk...NOT FOUND
    zimbra-ldap...NOT FOUND
    zimbra-logger...NOT FOUND
    zimbra-mta...NOT FOUND
    zimbra-dnscache...NOT FOUND
    zimbra-snmp...NOT FOUND
    zimbra-store...NOT FOUND
    zimbra-apache...NOT FOUND
    zimbra-spell...NOT FOUND
    zimbra-convertd...NOT FOUND
    zimbra-memcached...NOT FOUND
    zimbra-proxy...NOT FOUND
    zimbra-archiving...NOT FOUND
    zimbra-core...NOT FOUND


----------------------------------------------------------------------
PLEASE READ THIS AGREEMENT CAREFULLY BEFORE USING THE SOFTWARE.
SYNACOR, INC. ("SYNACOR") WILL ONLY LICENSE THIS SOFTWARE TO YOU IF YOU
FIRST ACCEPT THE TERMS OF THIS AGREEMENT. BY DOWNLOADING OR INSTALLING
THE SOFTWARE, OR USING THE PRODUCT, YOU ARE CONSENTING TO BE BOUND BY
THIS AGREEMENT. IF YOU DO NOT AGREE TO ALL OF THE TERMS OF THIS
AGREEMENT, THEN DO NOT DOWNLOAD, INSTALL OR USE THE PRODUCT.

License Terms for this Zimbra Collaboration Suite Software:
https://www.zimbra.com/license/zimbra-public-eula-2-6.html
----------------------------------------------------------------------



Do you agree with the terms of the software license agreement? [N] y





Use Zimbra's package repository [Y] y

Importing Zimbra GPG key

Configuring package repository

Checking for installable packages

Found zimbra-core (local)
Found zimbra-ldap (local)
Found zimbra-logger (local)
Found zimbra-mta (local)
Found zimbra-dnscache (local)
Found zimbra-snmp (local)
Found zimbra-store (local)
Found zimbra-apache (local)
Found zimbra-spell (local)
Found zimbra-memcached (repo)
Found zimbra-proxy (local)
Found zimbra-drive (repo)
Found zimbra-imapd (local)
Found zimbra-patch (repo)
Found zimbra-mta-patch (repo)
Found zimbra-proxy-patch (repo)


Select the packages to install

Install zimbra-ldap [Y] y
Install zimbra-logger [Y] y
Install zimbra-mta [Y] y

Install zimbra-dnscache [Y] n

Install zimbra-snmp [Y] y
Install zimbra-store [Y] y
Install zimbra-apache [Y] y
Install zimbra-spell [Y] y

Install zimbra-memcached [Y] n
Install zimbra-proxy [Y] n 
Install zimbra-drive [Y] n
Install zimbra-imapd (BETA - for evaluation only) [N] n
Install zimbra-chat [Y] n 


Checking required space for zimbra-core
Checking space for zimbra-store
Checking required packages for zimbra-store
zimbra-store package check complete.

Installing:
    zimbra-core
    zimbra-ldap
    zimbra-logger
    zimbra-mta
    zimbra-snmp
    zimbra-store
    zimbra-apache
    zimbra-spell
    zimbra-patch
    zimbra-mta-patch



The system will be modified.  Continue? [N] y


Beginning Installation - see /tmp/install.log.i6QG9t1d for details...

                          zimbra-core-components will be downloaded and installed.
                            zimbra-timezone-data will be installed.
                          zimbra-common-core-jar will be installed.
                         zimbra-common-mbox-conf will be installed.
                   zimbra-common-mbox-conf-attrs will be installed.
                    zimbra-common-mbox-conf-msgs will be installed.
                  zimbra-common-mbox-conf-rights will be installed.
                           zimbra-common-mbox-db will be installed.
                         zimbra-common-mbox-docs will be installed.
                   zimbra-common-mbox-native-lib will be installed.
                         zimbra-common-core-libs will be installed.
                                     zimbra-core will be installed.
                          zimbra-ldap-components will be downloaded and installed.
                                     zimbra-ldap will be installed.
                                   zimbra-logger will be installed.
                           zimbra-mta-components will be downloaded and installed.
                                      zimbra-mta will be installed.
                          zimbra-snmp-components will be downloaded and installed.
                                     zimbra-snmp will be installed.
                         zimbra-store-components will be downloaded and installed.
                       zimbra-jetty-distribution will be downloaded and installed.
                                zimbra-mbox-conf will be installed.
                                 zimbra-mbox-war will be installed.
                             zimbra-mbox-service will be installed.
                       zimbra-mbox-webclient-war will be installed.
                   zimbra-mbox-admin-console-war will be installed.
                          zimbra-mbox-store-libs will be installed.
                                    zimbra-store will be installed.
                        zimbra-apache-components will be downloaded and installed.
                                   zimbra-apache will be installed.
                         zimbra-spell-components will be downloaded and installed.
                                    zimbra-spell will be installed.
                                    zimbra-patch will be downloaded and installed (later).
                                zimbra-mta-patch will be downloaded and installed (later).


Downloading packages (8):
   zimbra-core-components
   zimbra-ldap-components
   zimbra-mta-components
   zimbra-snmp-components
   zimbra-store-components
   zimbra-jetty-distribution
   zimbra-apache-components
   zimbra-spell-components
      ...done

Removing /opt/zimbra
Removing zimbra crontab entry...done.
Cleaning up zimbra init scripts...done.
Cleaning up /etc/security/limits.conf...done.

Finished removing Zimbra Collaboration Server.


Installing repo packages (8):
   zimbra-core-components
   zimbra-ldap-components
   zimbra-mta-components
   zimbra-snmp-components
   zimbra-store-components
   zimbra-jetty-distribution
   zimbra-apache-components
   zimbra-spell-components
      ...done

Installing local packages (24):
   zimbra-timezone-data
   zimbra-common-core-jar
   zimbra-common-mbox-conf
   zimbra-common-mbox-conf-attrs
   zimbra-common-mbox-conf-msgs
   zimbra-common-mbox-conf-rights
   zimbra-common-mbox-db
   zimbra-common-mbox-docs
   zimbra-common-mbox-native-lib
   zimbra-common-core-libs
   zimbra-core
   zimbra-ldap
   zimbra-logger
   zimbra-mta
   zimbra-snmp
   zimbra-mbox-conf
   zimbra-mbox-war
   zimbra-mbox-service
   zimbra-mbox-webclient-war
   zimbra-mbox-admin-console-war
   zimbra-mbox-store-libs
   zimbra-store
   zimbra-apache
   zimbra-spell
      ...done

Installing extra packages (2):
   zimbra-patch
   zimbra-mta-patch
      ...done

Running Post Installation Configuration:
Installing zimbra-ldap-patch
Operations logged to /tmp/zmsetup.20250513-011932.log
Installing LDAP configuration database...done.
Setting defaults...




DNS ERROR resolving MX for mail.technbd.net
It is suggested that the domain name have an MX record configured in DNS

Change domain name? [Yes] yes

Create domain: [mail.technbd.net]   technbd.net
        MX: mail.technbd.net (192.168.10.191)

        Interface: 127.0.0.1
        Interface: ::1
        Interface: 192.168.10.191
        Interface: 172.17.0.1
done.
Checking for port conflicts


Main menu

   1) Common Configuration:
   2) zimbra-ldap:                             Enabled
   3) zimbra-logger:                           Enabled
   4) zimbra-mta:                              Enabled
   5) zimbra-snmp:                             Enabled
   6) zimbra-store:                            Enabled
        +Create Admin User:                    yes
        +Admin user to create:                 admin@technbd.net
******* +Admin Password                        UNSET
        +Anti-virus quarantine user:           virus-quarantine.uvs_o5mwe6@technbd.net
        +Enable automated spam training:       yes
        +Spam training user:                   spam.9bi1ufwk@technbd.net
        +Non-spam(Ham) training user:          ham.qaehlkw26@technbd.net
        +SMTP host:                            mail.technbd.net
        +Web server HTTP port:                 8080
        +Web server HTTPS port:                8443
        +HTTP proxy port:                      80
        +HTTPS proxy port:                     443
        +Web server mode:                      https
        +IMAP server port:                     7143
        +IMAP server SSL port:                 7993
        +IMAP proxy port:                      143
        +IMAP SSL proxy port:                  993
        +POP server port:                      7110
        +POP server SSL port:                  7995
        +POP proxy port:                       110
        +POP SSL proxy port:                   995
        +Use spell check server:               yes
        +Spell server URL:                     http://mail.technbd.net:7780/aspell.php
        +Configure for use with mail proxy:    TRUE
        +Configure for use with web proxy:     TRUE
        +Enable version update checks:         TRUE
        +Enable version update notifications:  TRUE
        +Version update notification email:    admin@technbd.net
        +Version update source email:          admin@technbd.net
        +Install mailstore (service webapp):   yes
        +Install UI (zimbra,zimbraAdmin webapps): yes

   7) zimbra-spell:                            Enabled
   8) Default Class of Service Configuration:
   s) Save config to file
   x) Expand menu
   q) Quit

```


_Set the password for the admin account, **select `6`** and **then select `4`**, and proceed:_

```
Address unconfigured (**) items  (? - help) 6


Store configuration

   1) Status:                                  Enabled
   2) Create Admin User:                       yes
   3) Admin user to create:                    admin@technbd.net
** 4) Admin Password                           UNSET
   5) Anti-virus quarantine user:              virus-quarantine.uvs_o5mwe6@technbd.net
   6) Enable automated spam training:          yes
   7) Spam training user:                      spam.9bi1ufwk@technbd.net
   8) Non-spam(Ham) training user:             ham.qaehlkw26@technbd.net
   9) SMTP host:                               mail.technbd.net
  10) Web server HTTP port:                    8080
  11) Web server HTTPS port:                   8443
  12) HTTP proxy port:                         80
  13) HTTPS proxy port:                        443
  14) Web server mode:                         https
  15) IMAP server port:                        7143
  16) IMAP server SSL port:                    7993
  17) IMAP proxy port:                         143
  18) IMAP SSL proxy port:                     993
  19) POP server port:                         7110
  20) POP server SSL port:                     7995
  21) POP proxy port:                          110
  22) POP SSL proxy port:                      995
  23) Use spell check server:                  yes
  24) Spell server URL:                        http://mail.technbd.net:7780/aspell.php
  25) Configure for use with mail proxy:       TRUE
  26) Configure for use with web proxy:        TRUE
  27) Enable version update checks:            TRUE
  28) Enable version update notifications:     TRUE
  29) Version update notification email:       admin@technbd.net
  30) Version update source email:             admin@technbd.net
  31) Install mailstore (service webapp):      yes
  32) Install UI (zimbra,zimbraAdmin webapps): yes


Select, or 'r' for previous menu [r] 4

Password for admin@technbd.net (min 6 characters): [PXJJdH7nB1] admin@1234



Store configuration

   1) Status:                                  Enabled
   2) Create Admin User:                       yes
   3) Admin user to create:                    admin@technbd.net
   4) Admin Password                           set
   5) Anti-virus quarantine user:              virus-quarantine.uvs_o5mwe6@technbd.net
   6) Enable automated spam training:          yes
   7) Spam training user:                      spam.9bi1ufwk@technbd.net
   8) Non-spam(Ham) training user:             ham.qaehlkw26@technbd.net
   9) SMTP host:                               mail.technbd.net
  10) Web server HTTP port:                    8080
  11) Web server HTTPS port:                   8443
  12) HTTP proxy port:                         80
  13) HTTPS proxy port:                        443
  14) Web server mode:                         https
  15) IMAP server port:                        7143
  16) IMAP server SSL port:                    7993
  17) IMAP proxy port:                         143
  18) IMAP SSL proxy port:                     993
  19) POP server port:                         7110
  20) POP server SSL port:                     7995
  21) POP proxy port:                          110
  22) POP SSL proxy port:                      995
  23) Use spell check server:                  yes
  24) Spell server URL:                        http://mail.technbd.net:7780/aspell.php
  25) Configure for use with mail proxy:       TRUE
  26) Configure for use with web proxy:        TRUE
  27) Enable version update checks:            TRUE
  28) Enable version update notifications:     TRUE
  29) Version update notification email:       admin@technbd.net
  30) Version update source email:             admin@technbd.net
  31) Install mailstore (service webapp):      yes
  32) Install UI (zimbra,zimbraAdmin webapps): yes

```


_After the password have been set, **return to the previous menu using `r` and Type `a` to begin installation then `yes` and `yes` to process the installation:**_


```
Select, or 'r' for previous menu [r] r

Main menu

   1) Common Configuration:
   2) zimbra-ldap:                             Enabled
   3) zimbra-logger:                           Enabled
   4) zimbra-mta:                              Enabled
   5) zimbra-snmp:                             Enabled
   6) zimbra-store:                            Enabled
   7) zimbra-spell:                            Enabled
   8) Default Class of Service Configuration:
   s) Save config to file
   x) Expand menu
   q) Quit




*** CONFIGURATION COMPLETE - press 'a' to apply

Select from menu, or press 'a' to apply config (? - help)   a


Save configuration data to a file? [Yes]  yes

Save config in file: [/opt/zimbra/config.27430]
Saving config in /opt/zimbra/config.27430...done.


The system will be modified - continue? [No]    yes

Operations logged to /tmp/zmsetup.20250512-181511.log


Setting local config values...done.
Initializing core config...Setting up CA...done.
Deploying CA to /opt/zimbra/conf/ca ...done.
Creating SSL zimbra-store certificate...done.
Creating new zimbra-ldap SSL certificate...done.
Creating new zimbra-mta SSL certificate...done.
Installing mailboxd SSL certificates...done.
Installing MTA SSL certificates...done.
Installing LDAP SSL certificate...done.
Initializing ldap...done.
Setting replication password...done.
Setting Postfix password...done.
Setting amavis password...done.
Setting nginx password...done.
Setting BES searcher password...done.
Creating server entry for mail.technbd.net...done.
Setting Zimbra IP Mode...done.
Saving CA in ldap...done.
Saving SSL Certificate in ldap...done.
Setting spell check URL...done.
Setting service ports on mail.technbd.net...done.
Setting zimbraFeatureTasksEnabled=TRUE...done.
Setting zimbraFeatureBriefcasesEnabled=TRUE...done.
Checking current setting of zimbraReverseProxyAvailableLookupTargets
Querying LDAP for other mailstores
Searching LDAP for reverseProxyLookupTargets...done.
Adding mail.technbd.net to zimbraReverseProxyAvailableLookupTargets
Updating zimbraLDAPSchemaVersion to version '1649766200'
Setting TimeZone Preference...done.
Initializing mta config...done.
Setting services on mail.technbd.net...done.
Adding mail.technbd.net to zimbraMailHostPool in default COS...done.
Creating domain technbd.net...done.
Setting default domain name...done.
Creating domain technbd.net...already exists.
Creating admin account admin@technbd.net...done.
Creating root alias...done.
Creating postmaster alias...done.
Creating user spam.9bi1ufwk@technbd.net...done.
Creating user ham.qaehlkw26@technbd.net...done.
Creating user virus-quarantine.uvs_o5mwe6@technbd.net...done.
Setting spam training and Anti-virus quarantine accounts...done.
Initializing store sql database...done.
Setting zimbraSmtpHostname for mail.technbd.net...done.
Configuring SNMP...done.
Setting up syslog.conf...done.
Setting java options...done.
Starting servers...done.
Enabling jetty logging...done.
Installing common zimlets...
        com_zimbra_adminversioncheck...done.
        com_zimbra_attachcontacts...done.
        com_zimbra_attachmail...done.
        com_zimbra_bulkprovision...done.
        com_zimbra_cert_manager...done.
        com_zimbra_date...done.
        com_zimbra_email...done.
        com_zimbra_mailarchive...done.
        com_zimbra_phone...done.
        com_zimbra_proxy_config...done.
        com_zimbra_srchhighlighter...done.
        com_zimbra_tooltip...done.
        com_zimbra_url...done.
        com_zimbra_viewmail...done.
        com_zimbra_webex...done.
        com_zimbra_ymemoticons...done.
Finished installing common zimlets.
Restarting mailboxd...done.
Creating galsync account for default domain...done.
```


_You can Type **`Yes` or `No`** to Notify Zimbra of your installation:_

```
You have the option of notifying Zimbra of your installation.
This helps us to track the uptake of the Zimbra Collaboration Server.
The only information that will be transmitted is:
        The VERSION of zcs installed (8.8.15_GA_3869_RHEL7_64)
        The ADMIN EMAIL ADDRESS created (admin@technbd.net)

Notify Zimbra of your installation? [Yes] no

Notification skipped
Checking if the NG started running...done.
Setting up zimbra crontab...done.


Moving /tmp/zmsetup.20250513-113814.log to /opt/zimbra/log


Configuration complete - press return to exit

```



```
telnet mail.technbd.net 25
```



```
nc -zv mail.technbd.net 25
```



```
nmap localhost

Starting Nmap 6.40 ( http://nmap.org ) at 2025-05-13 11:55 +06
Nmap scan report for localhost (127.0.0.1)
Host is up (0.0000040s latency).
Other addresses for localhost (not scanned): 127.0.0.1
Not shown: 990 closed ports

PORT      STATE SERVICE
22/tcp    open  ssh
25/tcp    open  smtp
53/tcp    open  domain

465/tcp   open  smtps
587/tcp   open  submission
7025/tcp  open  vmsvc-2
8080/tcp  open  http-proxy
8443/tcp  open  https-alt

10024/tcp open  unknown
10025/tcp open  unknown

```



```
netstat -tlpn

Active Internet connections (only servers)
Proto Recv-Q Send-Q Local Address           Foreign Address         State       PID/Program name
tcp        0      0 0.0.0.0:7073            0.0.0.0:*               LISTEN      56476/java
tcp        0      0 127.0.0.1:23233         0.0.0.0:*               LISTEN      48559/perl
tcp        0      0 127.0.0.1:7171          0.0.0.0:*               LISTEN      46701/java
tcp        0      0 192.168.10.191:389      0.0.0.0:*               LISTEN      46671/slapd
tcp        0      0 0.0.0.0:7110            0.0.0.0:*               LISTEN      56476/java
tcp        0      0 0.0.0.0:7143            0.0.0.0:*               LISTEN      56476/java
tcp        0      0 127.0.0.1:10663         0.0.0.0:*               LISTEN      48298/zmlogger: zmr
tcp        0      0 127.0.0.1:10024         0.0.0.0:*               LISTEN      48605/amavisd (mast
tcp        0      0 127.0.0.1:10025         0.0.0.0:*               LISTEN      49350/master
tcp        0      0 127.0.0.1:10026         0.0.0.0:*               LISTEN      48605/amavisd (mast
tcp        0      0 127.0.0.1:7306          0.0.0.0:*               LISTEN      48263/mysqld
tcp        0      0 127.0.0.1:10027         0.0.0.0:*               LISTEN      49350/master
tcp        0      0 0.0.0.0:587             0.0.0.0:*               LISTEN      49350/master
tcp        0      0 127.0.0.1:10028         0.0.0.0:*               LISTEN      49350/master
tcp        0      0 127.0.0.1:10029         0.0.0.0:*               LISTEN      49350/master
tcp        0      0 127.0.0.1:3310          0.0.0.0:*               LISTEN      48952/clamd
tcp        0      0 127.0.0.1:10030         0.0.0.0:*               LISTEN      49350/master
tcp        0      0 127.0.0.1:8080          0.0.0.0:*               LISTEN      56476/java
tcp        0      0 127.0.0.1:10032         0.0.0.0:*               LISTEN      48605/amavisd (mast
tcp        0      0 0.0.0.0:7025            0.0.0.0:*               LISTEN      56476/java
tcp        0      0 0.0.0.0:465             0.0.0.0:*               LISTEN      49350/master
tcp        0      0 127.0.0.1:8465          0.0.0.0:*               LISTEN      49002/opendkim
tcp        0      0 192.168.10.191:53       0.0.0.0:*               LISTEN      918/named
tcp        0      0 127.0.0.1:53            0.0.0.0:*               LISTEN      918/named
tcp        0      0 0.0.0.0:22              0.0.0.0:*               LISTEN      895/sshd
tcp        0      0 0.0.0.0:7993            0.0.0.0:*               LISTEN      56476/java
tcp        0      0 0.0.0.0:25              0.0.0.0:*               LISTEN      49350/master
tcp        0      0 127.0.0.1:953           0.0.0.0:*               LISTEN      918/named
tcp        0      0 0.0.0.0:7995            0.0.0.0:*               LISTEN      56476/java
tcp        0      0 0.0.0.0:8443            0.0.0.0:*               LISTEN      56476/java
tcp        0      0 0.0.0.0:7071            0.0.0.0:*               LISTEN      56476/java
tcp        0      0 0.0.0.0:7072            0.0.0.0:*               LISTEN      56476/java
tcp        0      0 127.0.0.1:23232         0.0.0.0:*               LISTEN      48557/perl
tcp6       0      0 :::7780                 :::*                    LISTEN      49042/httpd
tcp6       0      0 ::1:10024               :::*                    LISTEN      48605/amavisd (mast
tcp6       0      0 ::1:10026               :::*                    LISTEN      48605/amavisd (mast
tcp6       0      0 ::1:3310                :::*                    LISTEN      48952/clamd
tcp6       0      0 ::1:10032               :::*                    LISTEN      48605/amavisd (mast
tcp6       0      0 :::22                   :::*                    LISTEN      895/sshd
tcp6       0      0 ::1:953                 :::*                    LISTEN      918/named

```



#### Check the status of Zimbra:

```
su - zimbra
```


```
zmcontrol status


Host mail.technbd.net
        amavis                  Running
        antispam                Running
        antivirus               Running
        ldap                    Running
        logger                  Running
        mailbox                 Running
        mta                     Running
        opendkim                Running
        service webapp          Running
        snmp                    Running
        spell                   Running
        stats                   Running
        zimbra webapp           Running
        zimbraAdmin webapp      Running
        zimlet webapp           Running
        zmconfigd               Running
```



_Verify the installed version:_

```
zmcontrol -v

Release 8.8.15_GA_3869.RHEL7_64_20190917004220 RHEL7_64 FOSS edition, Patch 8.8.15_P45.
```



### Zimbra commands:

#### Service Management:

```
zmcontrol status 
zmcontrol start  
zmcontrol stop  
zmcontrol restart  
```


#### User Management:

```
zmprov createAccount user@example.com password123                  # Create a new account
zmprov deleteAccount user@example.com                              # Delete an account
zmprov getAccount user@example.com                                 # Show account details
zmprov modifyAccount user@example.com zimbraPassword newpass123    # Change password

zmprov GetAllAdminAccounts
```



#### Mail Queue and Logs:

```
postqueue -p                          # View mail queue
postsuper -d ALL                      # Delete all messages in the mail queue

tail -f /var/log/zimbra.log           # Live mail log
tail -f /opt/zimbra/log/mailbox.log   # Mailbox-specific logs
```


```
mailq

Mail queue is empty
```



#### Configuration & Environment:

```
zmhostname                 # Show the server's configured hostname
zmprov gas                 # List all servers in the Zimbra setup
zmprov gs `zmhostname`     # Get config of the current server
zmprov gac                 # List all accounts

```


#### Get Quota Usage:

```
zmprov getQuotaUsage mail.technbd.net


admin@technbd.net 0 335328
galsync.cxekrkwn21@technbd.net 0 0
ham.qaehlkw26@technbd.net 0 0
spam.9bi1ufwk@technbd.net 0 0
virus-quarantine.uvs_o5mwe6@technbd.net 0 0
```



```
zmprov RecalculateMailboxCounts admin@technbd.net

account: admin@technbd.net
quotaUsed: 335328
```






#### Zimbra shell utility script: (Optional)

This typically used inside Zimbra shell scripts to load and initialize environment variables for the Zimbra environment.

```
source ~/bin/zmshutil; zmsetvars
```


```
echo $zimbra_home

/opt/zimbra
```


```
echo $zimbra_server_hostname

mail.technbd.net
```


```
zmhostname

mail.technbd.net
```


```
hostname --fqdn
```







#### Uninstall Zimbra:

```
./install.sh -u
```





### Zimbra Server Web UI:

Access Zimbra Admin Console at: `https://192.168.10.191:7071` or: `https://mail.technbd.net:7071`
- Username : `admin`
- Password : you set during install


Clients can securely log in to their webmail boxes using the domain name or the server IP address via HTTPS protocol. Once installed as above, the Zimbra server can be accessed via a browser using the URL `https://server_ip` or `https://domain_name`.   





### Zimbra Proxy: Installing , Configuring, Disabling:

Zimbra Proxy (also referred in this wiki as Nginx-Zimbra or NZ in short) is an important component of ZCS. Zimbra Proxy is a high-performance proxy server that can be configured as a HTTP[S]/POP[S]/IMAP[S] proxy used to reverse proxy HTTP[S]/POP[S]/IMAP[S] client requests to a set of backend servers. It also provides functions like GSSAPI authentication, throttle control, SSL connection with different certificates for different virtual host names etc. In a typical use case, NZ extract user login information in someway (like account id or user name) and then fetches the route to the upstream mail server or web servers’ address from “Nginx Lookup Extension” (or called NLE for short), and finally proxy the interactions between clients and upstream ZCS servers. To accelerate the speed of route lookup, memcached is introduced, which caches the lookup result. Therefore, the subsequent login with the same username will directly be proxied without looking up in NLE.


#### Zimbra Proxy Ports:

|Zimbra Proxy Ports (External to ZCS)|	Port|
|------------------------------------|-----|
|HTTP|	80|
|HTTPS|	443|
|POP3|	110|
|POP3S (Secure POP3)|	995|
|IMAP|	143
|IMAPS (Secure IMAP)|	993|


|Zimbra Mailbox Ports (Internal to ZCS)|	Port|
|------------------------------------|-----|
|Route Lookup Handler|	7072|
|HTTP Backend (if Proxy configured)|	8080|
|HTTPS Backend (if Proxy configured)|	8443|
|POP3 Backend (if Proxy configured)|	7110|
|POP3S Backend (if Proxy configured)|	7995|
|IMAP Backend (if Proxy configured)|	7143|
|IMAPS Backend (if Proxy configured)|	7993|
|Mailbox Admin console|	7071|



#### TLS/SSL and Access:

After install is done, enable web/mail proxy, and set the proxy mode and ports:

```
zmtlsctl -help


Warning: No proxy servers were detected. No validation will be performed.
Usage: /opt/zimbra/bin/zmtlsctl [both|http|https|redirect|mixed|help]
```


_To allow both HTTP and HTTPS (used for flexibility):_

```
zmtlsctl both

Warning: No proxy servers were detected. No validation will be performed.
Attempting to set ldap config zimbraMailMode both on host mail.technbd.net...done.
Rewriting config files for cyrus-sasl, webxml, mailboxd, service, zimbraUI, and zimbraAdmin...done.
```


```
zmprov gs `zmhostname` | grep MailMode

zimbraMailMode: both
```


#### Proxy ports Migration Steps:

_Proxy status (if using zimbra-proxy):_

```
zmproxyctl status 

proxy is not running.
```


```
zmprov -l gs `zmhostname` | grep -i port
```



Flags:
- `-e` : Enable proxy service.
- `-m` : Enable mailbox service
- `-w` : Enable web (mailbox) service.
- `-o` : Overwrite existing proxy configuration.
- `-a` : Configure Web proxy ports
- `-i` :	Configure IMAP proxy ports
- `-p` :	Configure POP3 proxy ports
- `-H` : Hostname of server on which enable/disable proxy functionality.

- `-a 8080:80:8443:443` : 
   - 8080 (internal HTTP port) to 80 (external HTTP)
   - 8443 (internal HTTPS port) to 443 (external HTTPS)

- `-i 7143:143:7993:993` (IMAP) :
   - 7143: internal proxy port for IMAP (plaintext)
   - 143: external IMAP (standard client port)
   - 7993: internal proxy port for IMAPS (SSL)
   - 993: external IMAPS (standard SSL client port)

- `-p 7110:110:7995:995` (POP3) :
   - 7110: internal proxy port for POP3 (plaintext)
   - 110: external POP3 (standard client port)
   - 7995: internal proxy port for POP3S (SSL)
   - 995: external POP3S (standard SSL client port)



_If localconfig key 'zimbra_require_interprocess_security' is set, Only "https" and "both" are valid modes:_
```
/opt/zimbra/libexec/zmproxyconfig -e -w -o -a 8080:80:8443:443 -H `zmhostname`
```


_Set the mail proxy ports:_
```
/opt/zimbra/libexec/zmproxyconfig -e -m -o -i 7143:143:7993:993 -p 7110:110:7995:995 -H `zmhostname`
```




_Disables Proxy Ports:_

```
zmprov ms `zmhostname` zimbraImapProxyBindPort 0
zmprov ms `zmhostname` zimbraImapSSLProxyBindPort 0

zmprov ms `zmhostname` zimbraPop3ProxyBindPort 0
zmprov ms `zmhostname` zimbraPop3SSLProxyBindPort 0

zmprov ms `zmhostname` zimbraMailProxyPort 0
zmprov ms `zmhostname` zimbraMailSSLProxyPort 0
```



_Enables Direct Bind to Mailbox Server:_

These enable the mailbox server itself to bind directly to standard service ports, without proxy involvement.

```
zmprov ms `zmhostname` zimbraImapBindPort 143
zmprov ms `zmhostname` zimbraImapSSLBindPort 993

zmprov ms `zmhostname` zimbraPop3BindPort 110
zmprov ms `zmhostname` zimbraPop3SSLBindPort 995

zmprov ms `zmhostname` zimbraMailPort 80
zmprov ms `zmhostname` zimbraMailSSLPort 443
```



```
zmcontrol restart
```



```
nmap mail.technbd.net

Starting Nmap 6.40 ( http://nmap.org ) at 2025-05-13 14:17 +06
Nmap scan report for mail.technbd.net (192.168.10.191)
Host is up (0.00031s latency).
Not shown: 987 closed ports

PORT     STATE SERVICE
22/tcp   open  ssh
25/tcp   open  smtp
53/tcp   open  domain
80/tcp   open  http
110/tcp  open  pop3
143/tcp  open  imap
389/tcp  open  ldap
443/tcp  open  https
465/tcp  open  smtps
587/tcp  open  submission
993/tcp  open  imaps
995/tcp  open  pop3s
7025/tcp open  vmsvc-2

```



#### Proxy Service disable:

_Once complete, To disable Zimbra services:_

```
zmprov ms `zmhostname` -zimbraServiceEnabled memcached
zmprov ms `zmhostname` -zimbraServiceEnabled imapproxy
```


```
zmcontrol restart
```


_If Enable:_

```
zmprov ms `zmhostname` +zimbraServiceEnabled memcached
zmprov ms `zmhostname` +zimbraServiceEnabled imapproxy
```



_Verify services:_

```
zmprov gs `zmhostname` | grep zimbraServiceEnabled


zimbraServiceEnabled: amavis
zimbraServiceEnabled: antivirus
zimbraServiceEnabled: antispam
zimbraServiceEnabled: opendkim
zimbraServiceEnabled: logger
zimbraServiceEnabled: service
zimbraServiceEnabled: zimbra
zimbraServiceEnabled: zimbraAdmin
zimbraServiceEnabled: zimlet
zimbraServiceEnabled: mailbox
zimbraServiceEnabled: mta
zimbraServiceEnabled: stats
zimbraServiceEnabled: snmp
zimbraServiceEnabled: ldap
zimbraServiceEnabled: spell
```






### Zimbra SSL Install:

Acquire a certificate from a recognized Certificate Authority (CA), or generate one for free with Let’s Encrypt.


#### GUI: 

1. Generate a CSR:

- Go to Home - Configure - Certificates: 
- click `setting icon` - click `Install Certificate` -
- Server name: mail.technbd.net - click `Next`
- select `Generate the CSR for the commercial certificate authorizer` - click `Next`
   - Digest: sha256
   - Key Length: 2048
   - Common name:  mail.technbd.net
   - Country Name: BD
   - State: Dhaka
   - City: Dhaka
   - Organization name: Technbd
   - Organization unit: NA
   - Subject Alternative name:  mail.technbd.net - click `Next`

- Finish



_Check CSR file and Created two files:_

```
ll /opt/zimbra/ssl/zimbra/commercial/

-rw-r----- 1 zimbra zimbra 1098 May 13 16:00 commercial.csr
-rw------- 1 zimbra zimbra 1704 May 13 16:00 commercial.key
```



2. Install an SSL Certificate:

Now, you need to upload your certificate (.crt file) and Ca bundle certificates (.ca-bundle file). 
_Update the following files:_

- **Certificate**: your SSL certificate file with the .crt extension.
- **RootCA**: this is the last (third) certificate from your CA bundle file.
- **Intermediate CA**: this is the second certificate from your CA bundle file.
- **Intermediate CA**: this is the first certificate from your CA bundle file


Go to Home - Configure - Certificates: 
- click `setting icon` - click `Install Certificate` -
- Server name: mail.technbd.net - click `Next`
- select `Install the commercially signed certificate` - click `Next`
- click `Next`
- Upload: 
   - Certificate:
   - Root CA:
   - Intermediate CA: 
   - click `Next` - click - `Install`

- Finish




#### CLI: 

You need the **certificate (.crt)** file & the **CA bundle (.ca-bundle)** file. If you didn’t create the CSR on Zimbra, you **must name your private key file** `commercial.key` and upload it to the following directory: `/opt/zimbra/ssl/zimbra/commercial`.

Upload your **certificate** and **CA bundle** files (containing the root and intermediate certificate) to a directory of your choice on the server like: `/opt/zimbra/ssl/zimbra/commercial`. 


1. Combine root and intermediate CA certificates:

_Syntax for CA bundle CRT:_
```
cat rootCA.crt intermediateCA.crt >> domain.com_ca.crt
```


_Add the chain certs to a single file like `domain.com_ca.crt`:_

```
cat SectigoRSADomainValidationSecureServerCA.crt USERTrustRSAAAACA.crt AAACertificateServices.crt >> domain.com_ca.crt
```



_Syntax for certificate (.crt):_

```
cat mail.domain.com.crt domain.com_ca.crt >> domain.com.bundle.crt
```


Add the domain certificate and chain files to a single file like `domain.com.bundle.crt`:

```
cat mail.domain.com.crt SectigoRSADomainValidationSecureServerCA.crt USERTrustRSAAAACA.crt AAACertificateServices.crt >> domain.com.bundle.crt
```



2. Verify your certificate:

```
/opt/zimbra/bin/zmcertmgr verifycrt comm commercial.key domain.com.bundle.crt domain.com_ca.crt
```


3. Deploy your SSL certificate:


_Syntax:_
```
zmcertmgr deploycrt comm <certificate> <root+intermediate>
zmcertmgr deploycrt comm <server.domain.com.crt> <root+intermediate>
```


```
/opt/zimbra/bin/zmcertmgr deploycrt comm domain.com.bundle.crt domain.com_ca.crt
```


4. Verify the certificate deployment:

```
/opt/zimbra/bin/zmcertmgr viewdeployedcrt
```


```
su - zimbra

zmcontrol restart
```



### Create SPF record for Zimbra:

**Sender Policy Framework** (SPF) is an email validation system, designed to prevent unwanted emails using a spoofing system. To check this common security problem, SPF going to verify the source IP of the email and compare it with a DNS TXT record with a SPF content. **Tells the world which IPs or servers are allowed to send mail for your domain.**


```
v=spf1 mx ip4:123.123.123.123 ~all

Or,

v=spf1 a mx a:mail.technbd.net ip4:192.168.10.191 ~all
```



### Generate DKIM key on Zimbra:

**DomainKeys Identified Mail** (DKIM) lets an organization take responsibility for a message that is in transit. DKIM helps the receiving mail server confirm that the email is fake or not fake. Spoofing mail domain names to send fake emails is very common, so DKIM as a tool helps mail server to distinguish real mail and fake mail. **Adds a digital signature to outgoing emails so the receiver can verify the message wasn’t altered and came from your domain.**


To add DKIM data to the new domain, run the following command:

```
/opt/zimbra/libexec/zmdkimkeyutil -a -d your_domain.com

/opt/zimbra/libexec/zmdkimkeyutil -a -d technbd.net
```





### Create DMARC record for Zimbra:

DMARC, which stands for “**Domain-based Message Authentication, Reporting & Conformance**”, is a technical specification created by a group of organizations that want to help reduce the potential for email-based abuse by solving a couple of long-standing operational, deployment, and reporting issues related to email authentication protocols. **Uses SPF + DKIM results to decide what to do with failed messages and allows you to get reports from other email providers.**

- p=reject: Reject failed messages
- p=quarantine: Mark as spam
- p=none: Just report (no enforcement)
- rua: Where to send reports
- adkim=s: Strict DKIM check
- aspf=s: Strict SPF check
- Record name: _dmarc.technbd.net

```
v=DMARC1; p=quarantine; rua=mailto:dmarc@technbd.net; ruf=mailto:dmarc@technbd.net; sp=quarantine

Or,

v=DMARC1; p=quarantine; rua=mailto:dmarc@technbd.net; ruf=mailto:dmarc@technbd.net; adkim=s; aspf=s; sp=quarantine
```








### Troubleshooting:


#### Common Issues in Zimbra:

- Mail Delivery Failures: Emails not being sent or received.
- Service Downtime: Zimbra services failing to start or stop.
- Authentication Problems: Users unable to log in.
- Performance Issues: Slow email delivery or system lag.
- Backup and Restore Challenges: Difficulty recovering lost data.



_To monitor logs in real-time:_
```
tail -f /var/log/zimbra.log           # Live mail log
tail -f /opt/zimbra/log/mailbox.log   # Mailbox-specific logs
```


_To view email logs for all users:_
```
/opt/zimbra/libexec/zmmsgtrace
```


_Filter Logs by Sender:_
```
/opt/zimbra/libexec/zmmsgtrace -s jaber@technbd.net
```


_Filter Logs by Receiver:_
```
/opt/zimbra/libexec/zmmsgtrace -r '@gmail.com'
```




#### Issues 1:
Unable to start TLS: SSL connect attempt failed error:14090086:SSL routines:ssl3_get_server_certificate:certificate verify failed when connecting to ldap master.

```
zmlocalconfig -e ldap_starttls_required=false
zmlocalconfig -e ldap_starttls_supported=0
zmcontrol restart
```


#### Issues 2:
File permission repair command:

```
zmcontrol stop

/opt/zimbra/libexec/zmfixperms -e  -v
```


#### Issues 3:
Zimbra mail queue location:

```
/opt/zimbra/common/sbin/postqueue -p         # current queue status
/opt/zimbra/common/sbin/postsuper -r ALL     # requeue all
/opt/zimbra/common/sbin/postsuper -d ALL     # delete all
/opt/zimbra/common/sbin/postsuper -h ALL     # hold all
```





### Links:
- [Install Zimbra on Rocky](https://computingforgeeks.com/install-zimbra-mail-server-on-rocky-almalinux-rhel/)
- [Install Zimbra on CentOS 8](https://computingforgeeks.com/install-zimbra-mail-server-on-centos-rhel/)
- [Install Zimbra](https://imanudin.net/2023/10/06/how-to-install-zimbra-10-open-source-edition-on-rocky-linux/)
- [Install Zimbra Suite](https://www.tecmint.com/install-zimbra-collaboration-suite-on-centos-rhel/)
- [Zimbra Proxy: Installing , Configuring, Disabling](https://wiki.zimbra.com/wiki/Zimbra_Proxy_Manual:Installing_,_Configuring,_Disabling_the_Zimbra_Proxy)
- [Default Zimbra Ports](https://wiki.zimbra.com/wiki/Ports)
- [Install SSL Cert on Zimbra](https://certera.com/kb/how-to-install-ssl-certificate-on-zimbra/)
- [Email Protection: SPF, DKIM and DMARC](https://wiki.zimbra.com/wiki/Best_Practices_on_Email_Protection:_SPF,_DKIM_and_DMARC)
- [SPF Record Generator](https://mxtoolbox.com/SPFRecordGenerator.aspx)
- [DMARC Record Assistant](https://www.kitterman.com/dmarc/assistant.html)
- [SPF/DKIM/DMARC Tools](https://dmarcly.com/tools/)

